# Uncrustify Configuration for NGINX Module
# Reference: https://nginx.org/en/docs/dev/development_guide.html#code_style

# =============================================================================
# Basic Settings
# =============================================================================

# Line endings: Unix style (LF)
newlines = lf

# Tab settings
input_tab_size = 4
output_tab_size = 4
indent_columns = 4
indent_with_tabs = 0              # Use spaces, not tabs

# Line length (Section 3.4: recommended 80, max 100)
code_width = 80

# =============================================================================
# Function Definitions & Declarations (Section 3.3)
# =============================================================================

# Force newline between return type and function name in definitions
nl_func_type_name = force

# Function definition parameters: use 4-space indent (not paren alignment)
indent_func_def_param = true

# Function prototype/declaration parameters: use 4-space indent
# Nginx style: continuation lines use 4-space indent for declarations
indent_func_proto_param = true

# Avoid aligning with open parenthesis for function definitions
indent_func_def_param_paren_pos_threshold = 0

# =============================================================================
# Function Calls
# =============================================================================

# Function call parameters: align with open parenthesis
indent_func_call_param = false
use_indent_func_call_param = true

# =============================================================================
# Brace Placement (Section 3.2)
# =============================================================================

# Function definition: newline before opening brace
nl_fdef_brace = add

# K&R style: opening brace on same line for control structures
nl_fcall_brace = remove
nl_if_brace = remove
nl_brace_else = remove
nl_while_brace = remove
nl_for_brace = remove
nl_switch_brace = remove

# else/else if: keep on same line as closing brace
nl_else_brace = remove
nl_elseif_brace = remove

# do-while: closing brace and while on same line
nl_brace_while = remove

# Multi-line conditions: opening brace on its own line
# Note: Uncrustify handles this via nl_multi_line_cond setting
nl_multi_line_cond = true

# =============================================================================
# Struct Member Alignment (Section 3.5)
# =============================================================================

# Align struct members by type name
align_var_struct_span = 5         # Number of lines to look for alignment
align_var_struct_gap = 2          # Minimum spaces between type and name
align_var_struct_thresh = 20      # Maximum spaces for alignment

# =============================================================================
# Pointer Alignment (Section 3.5)
# =============================================================================

# Pointer style: type *name (star attached to name)
align_var_def_star_style = 2      # 2 = right align (attach to name)

# =============================================================================
# Switch/Case (Section 3.6)
# =============================================================================

# case labels at same level as switch
indent_switch_case = 0

# =============================================================================
# Spacing (Section 3.5)
# =============================================================================

# Pointer/reference operators
sp_before_ptr_star = force        # Space before *
sp_after_ptr_star = remove        # No space after *
sp_between_ptr_star = remove      # No space between **

# Parentheses
sp_inside_paren = remove          # No space inside ()
sp_before_sparen = force          # Space before ( in if/while/for
sp_after_sparen = force           # Space after ) in if/while/for

# Type cast: (type) value (space after cast)
sp_after_cast = force

# Operators
sp_assign = force                 # Space around =
sp_arith = force                  # Space around arithmetic operators
sp_bool = force                   # Space around boolean operators
sp_compare = force                # Space around comparison operators

# Function calls
sp_func_call_paren = remove       # No space before ( in function calls
sp_inside_fparen = remove         # No space inside function ()

# =============================================================================
# Binary Operator Position
# =============================================================================

# &&, || at beginning of continuation line
pos_bool = lead

# =============================================================================
# Indentation
# =============================================================================

# Basic indentation
indent_brace = 0                  # Don't indent braces

# Control structures
indent_braces = false
indent_braces_no_func = false
indent_braces_no_class = false
indent_braces_no_struct = false

# Labels at column 0 (leftmost position)
indent_label = 1

# =============================================================================
# Blank Lines
# =============================================================================

# nl_max: maximum consecutive newlines (3 = up to 2 blank lines)
# Nginx core uses double blank lines between top-level sections
# and single blank lines within functions for logical separation
nl_max = 3

# Preserve blank lines within function bodies
# Nginx style uses blank lines between logical blocks
eat_blanks_before_close_brace = false
eat_blanks_after_open_brace = false

# Remove leading blank lines at start of file
nl_start_of_file = remove

# =============================================================================
# Comments (Section 4)
# =============================================================================

# C-style comments only (/* */, not //)
# Note: Uncrustify doesn't enforce this, but preserves existing style

# =============================================================================
# Alignment
# =============================================================================

# Don't align consecutive assignments
align_assign_span = 0
align_enum_equ_span = 0

# Variable definitions (no alignment - OIDC module has diverse type name lengths)
align_var_def_span = 0
align_var_def_star_style = 2      # Pointer alignment (star attached to name)
align_var_def_amp_style = 2       # Reference alignment

# =============================================================================
# Other Settings
# =============================================================================

# Don't modify one-liners
nl_if_leave_one_liners = false
nl_while_leave_one_liners = false
nl_for_leave_one_liners = false
nl_func_leave_one_liners = false

# Preprocessor
pp_indent = ignore

# EOF handling
nl_end_of_file = force            # Force newline at end of file
nl_end_of_file_min = 1            # Minimum 1 newline at EOF
